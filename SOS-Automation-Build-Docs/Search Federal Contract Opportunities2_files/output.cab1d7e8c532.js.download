let nanoid=(t=21)=>{let e="",r=crypto.getRandomValues(new Uint8Array(t));for(;t--;){let n=63&r[t];e+=n<36?n.toString(36):n<62?(n-26).toString(36).toUpperCase():n<63?"_":"-"}return e}
function hierarchy_refresh(id,hier_type,csrf_token,url){$.ajax({type:'POST',url:url,data:{"csrfmiddlewaretoken":csrf_token,"id":id,"hier_type":hier_type},success:function(data){$("#hierarchy").html(data)}})}
function show_hierarchy_modal(id,hier_type,csrf_token,url){var myModal=new bootstrap.Modal(document.getElementById("exampleModal"),{});myModal.show();hierarchy_refresh(id,hier_type,csrf_token,url)}
function generate_saved_search_dropdown(csrf_token,url,search_table,report_flag='False',save_box=false){$.ajax({type:'POST',url:url,data:{"csrfmiddlewaretoken":csrf_token,"search_table":search_table.replace('sl_','sl/').replace('_','-'),'report_flag':report_flag},success:function(data){if(save_box){$("#search_name_list").html("");var doc=new window.DOMParser().parseFromString(data,"text/html");var dropdown_items=doc.querySelectorAll("a.dropdown-item");dropdown_items.forEach(function(item){$("#search_name_list").append('<option value="'+item.innerText+'"/>');});}else{$("#saved_search_dropdown").html(data)}}})}
function generate_pipeline_dropdown(csrf_token){$.ajax({type:'POST',url:'/pipeline_dropdown/',data:{"csrfmiddlewaretoken":csrf_token,'table':table,'key':key},success:function(data){$("#pipeline_dropdown").html(data)}})}
function generate_pipeline_dropdown_table(csrf_token,table,key,id){console.log('key',key)
console.log('id',id)
$.ajax({type:'POST',url:'/pipeline_dropdown_table/',data:{"csrfmiddlewaretoken":csrf_token,"table":table,"key":key,"id":id},success:function(data){$("#pipeline_dropdown_"+id).html(data)}})}
function create_pursuit_auto(csrf_token,pipeline,table,key){$.ajax({type:'POST',url:'/create_pursuit/',data:{"csrfmiddlewaretoken":csrf_token,"pipeline":pipeline,"table":table,"key":key},success:function(data){show_toast('Pursuit Created',`<p>View the new pursuit <a href="/pursuit/${data}">here.<a><p>`)}})}
function create_pursuit_auto_zap(csrf_token,pipeline,table,key,api_transaction_key,title){show_toast('Sending Pursuit',`<p>Preparing to send pursuit to external CRM<p>`)
$.ajax({type:'POST',url:'/create_pursuit_zap/',data:{"csrfmiddlewaretoken":csrf_token,"pipeline":pipeline,"table":table,"key":key,"transaction_key":api_transaction_key,"title":title},success:function(data){show_toast('Pursuit Sent',`<p>Pursuit sent to ${data}<p>`)}})}
function add_user_modal(csrf_token,url){var myModal=new bootstrap.Modal(document.getElementById("addUserModal"),{});myModal.show();$.ajax({type:'POST',url:url,data:{"csrfmiddlewaretoken":csrf_token},success:function(data){$("#add_user").html(data)}})}
function toggle_complete_activity(csrf_token,task_key_internal){$.ajax({type:'POST',url:'/activity/toggle/'+task_key_internal,data:{"csrfmiddlewaretoken":csrf_token,},success:function(data){}})
kill_task_modal()}
function show_task_modal_anywhere(){function loadScript(url){return new Promise(function(resolve,reject){$.getScript(url,function(){resolve();});});}
const scripts=['https://cdn.jsdelivr.net/npm/vue@2.6.14','https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js','https://cdn.jsdelivr.net/npm/v-calendar@2.4.1/lib/v-calendar.umd.min.js','https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.1/dayjs.min.js','https://cdnjs.cloudflare.com/ajax/libs/vue-multiselect/2.1.0/vue-multiselect.min.js',];Promise.all(scripts.map(loadScript)).then(function(){show_task_modal(csrf);});}
function show_task_modal(csrf_token,id='None',linked_pursuit='None'){kill_task_modal()
if(id=='None'){path='new'}else{path=id}
$.ajax({type:'POST',url:'/activity/'+path,data:{"csrfmiddlewaretoken":csrf_token,"linked_pursuit":linked_pursuit},success:function(data){document.getElementById("modal_placeholder").insertAdjacentHTML('afterbegin',data)
var arr=document.getElementById("modal_placeholder").getElementsByTagName('script')
for(var n=0;n<arr.length;n++)
eval(arr[n].innerHTML)
var myModal=new bootstrap.Modal(document.getElementById("task_modal"),{});myModal.show();}})}
function show_contact_modal_anywhere(){function loadScript(url){return new Promise(function(resolve,reject){$.getScript(url,function(){resolve();});});}
const scripts=['https://cdn.jsdelivr.net/npm/vue@2.6.14','https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js','https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.1/dayjs.min.js','https://cdnjs.cloudflare.com/ajax/libs/vue-multiselect/2.1.0/vue-multiselect.min.js',];Promise.all(scripts.map(loadScript)).then(function(){show_contact_modal(csrf);});}
function kill_contact_modal(){document.getElementById("modal_placeholder2").innerHTML=''}
function show_contact_modal(csrf_token,contact_key='None'){kill_contact_modal()
if(contact_key=='None'){path='new'}else{path=contact_key}
$.ajax({type:'POST',url:'/contact/'+path,data:{"csrfmiddlewaretoken":csrf_token,},success:function(data){document.getElementById("modal_placeholder2").insertAdjacentHTML('afterbegin',data)
var arr=document.getElementById("modal_placeholder2").getElementsByTagName('script')
for(var n=0;n<arr.length;n++)
eval(arr[n].innerHTML)
var myModal=new bootstrap.Modal(document.getElementById("contact_modal"),{});myModal.show()}})}
function show_lifecyle_modal(sol,notice_id){var myModal=new bootstrap.Modal(document.getElementById("lifecycleModal"),{});myModal.show();$.ajax({type:'POST',url:'/show_lifecycle/',data:{"csrfmiddlewaretoken":csrf,"sol":sol,'notice_id':notice_id},success:function(data){document.getElementById("lifecycle").innerHTML=data}})}
function load_tooltips(){var tooltipTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));var showDelay=300;tooltipTriggerList.forEach(function(tooltipTriggerEl){var tooltipInstance=new bootstrap.Tooltip(tooltipTriggerEl,{boundary:'window',trigger:'manual'});var timeout;tooltipTriggerEl.addEventListener('mouseenter',function(){clearTimeout(timeout);timeout=setTimeout(function(){tooltipInstance.show();},showDelay);});tooltipTriggerEl.addEventListener('mouseleave',function(){clearTimeout(timeout);tooltipInstance.hide();});});}
function load_popovers(){try{var popoverTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
var popoverList=popoverTriggerList.map(function(popoverTriggerEl){return new bootstrap.Popover(popoverTriggerEl)})
var popover=new bootstrap.Popover(document.querySelector('.popover-dismiss'),{trigger:'focus'})}catch{}}
function load_toast(){var toastElList=[].slice.call(document.querySelectorAll('.toast'))
var toastList=toastElList.map(function(toastEl){return new bootstrap.Toast(toastEl)})}
function show_toast(header,body){document.getElementById('toast_header').innerHTML=header
document.getElementById('toast_body').innerHTML=body
bootstrap.Toast.getInstance(document.getElementById('liveToast')).show()}
function store_recent(){$.post('/visit/',{obj_type:table.replace('sl_','sl/').replace('_','-'),key:path_key,display:display,csrfmiddlewaretoken:csrf});}
function follow_toggle(box,pk,table,csrf,display){if(typeof display==="undefined"&&typeof window.display!=="undefined"){display=window.display;}
$.post("/toggle/",{checked:box,pk:pk,table:table,display:display,csrfmiddlewaretoken:csrf,});};function exclude_toggle(box,pk,table,csrf){$.post("/exclude_toggle/",{checked:box,pk:pk,table:table,csrfmiddlewaretoken:csrf,});};function track_toggle(box,pk,table,transaction_key,display,csrf){$.post("/track_toggle/",{checked:box,pk:pk,table:table,transaction_key:transaction_key,display:display,csrfmiddlewaretoken:csrf,});};function save_search(search_id,search_table,search_json,search_saved_name,update_frequency,csrf){$.post("/save_search/",{search_id:search_id,search_table:search_table.replace('sl_','sl/').replace('_','-'),search_json:JSON.stringify(search_json),search_saved_name:search_saved_name,update_frequency:update_frequency,csrfmiddlewaretoken:csrf,},).done(function(){if(search_saved_name.length>1){show_toast('Saved Search','<p>Search saved successfully.<p>  See your <a href=/search/>Saved Searches</a>.')
document.getElementById('search_saved_name').value=''}})};function save_search_notify(base,search_table,string){search_id=nanoid()
if(base=='person'){search_json={"person":{"code":[{"key":key,"display":display}],"include":"Include"},"id":search_id}
search_saved_name=display+' '+string}else if(base=='contractors'){search_json={"contractors":{"code":[{"key":key,"display":display}],"include":"Include"},"id":search_id}
search_saved_name=display+' '+string}else if(base=='vehicle'){search_json={"vehicle":{"code":[{"key":key,"display":display}],"include":"Include"},"id":search_id}
search_saved_name=display+' '+string}else if(base=='gemini_agency_key'){search_json={"gemini_agency_key":{"code":[{"key":key,"display":display}],"include":"Include"},"id":search_id}
search_saved_name=display+' '+string}else if(base=='awarding_agency'){search_json={"awarding_agency":{"code":[{"key":key,"display":display}],"include":"Include"},"id":search_id}
search_saved_name=display+' '+string}else if(base=='idv_award'){search_json={"idv_award":{"code":[{"key":key,"display":display}],"include":"Include"},"id":search_id}
search_saved_name=display+' '+string}else if(base=='sl_agency'){search_json={"awarding_agency":{"code":[{"key":key,"display":display}],"include":"Include"},"id":search_id}
search_saved_name=display+' '+string}else if(base=='sl_people'){search_json={"person":{"code":[{"key":key,"display":display}],"include":"Include"},"id":search_id}
search_saved_name=display+' '+string}
$.post("/save_search/",{search_id:search_id,search_table:search_table,search_json:JSON.stringify(search_json),search_saved_name:search_saved_name,update_frequency:'weekly',csrfmiddlewaretoken:csrf,},).done(function(){if(search_saved_name.length>1){show_toast('Saved Search','<p>Search saved successfully.<p>  See your <a href=/search/>Saved Searches</a>.')
document.getElementById('search_saved_name').value=''}})};function load_search_modals(){var mobileSearchModal=document.getElementById('mobileSearchModal')
mobileSearchModal.addEventListener('show.bs.modal',function(event){var fragment=document.createDocumentFragment();fragment.appendChild(document.getElementsByClassName('autoComplete_wrapper')[0])
document.getElementById('hierarchy_interior').appendChild(fragment)})
mobileSearchModal.addEventListener('hide.bs.modal',function(event){var fragment=document.createDocumentFragment();fragment.appendChild(document.getElementsByClassName('autoComplete_wrapper')[0])
document.getElementById('quicksearch_desktop').appendChild(fragment)})}
function enable_side_bar(){const simpleBarElement=document.getElementsByClassName("js-simplebar")[0];if(simpleBarElement){new SimpleBar(document.getElementsByClassName("js-simplebar")[0])
const sidebarElement=document.getElementsByClassName("sidebar")[0];const sidebarToggleElement=document.getElementsByClassName("sidebar-toggle")[0];sidebarToggleElement.addEventListener("click",()=>{sidebarElement.classList.toggle("collapsed");if(screen.width<767&&sidebarElement.classList.contains('collapsed')){document.getElementById('main-area').classList.add('main-overflow-collapse')}else{document.getElementById('main-area').classList.remove('main-overflow-collapse')}
sidebarElement.addEventListener("transitionend",()=>{window.dispatchEvent(new Event("resize"));});});}}
function highlight_sidebar(){path=window.location.pathname.replace('sl/','sl-')
active_class='.nav_'+path.replace(/^\/([^\/]*).*$/,'$1')
document.querySelectorAll(active_class).forEach(function(el){el.classList.add('active');el.classList.remove('collapse');el.classList.remove('collapsed');});}
function highlightMatch(markedResult){searchQuery=document.getElementById("autoComplete").value
try{searchQuery.split(" ").forEach(function(fragment){if(fragment.length>0){markedResult=markedResult.replace(new RegExp(fragment+'+(?![^<]*\>)',"gi"),(match)=>`<mark>${match}</mark>`);markedResult=markedResult.replace('~p~',`<span class="badge bg-primary" style="vertical-align:middle; font-size:75%">P</span>`)
markedResult=markedResult.replace('~c~',`<span class="badge bg-info" style="vertical-align:middle; font-size:75%">C</span>`)}});}
catch(err){}
return markedResult}
function search(ele){if(event.key==='Enter'&&search_all_on_enter){quicksearch_id=nanoid()
$.post("/save_search/",{search_id:quicksearch_id,search_table:'all',search_json:JSON.stringify({"id":quicksearch_id,"free_text":document.getElementById("autoComplete").value}),search_saved_name:null,update_frequency:null,csrfmiddlewaretoken:csrf,}).done(function(){window.open(`/all?searchID=${quicksearch_id}`,"_self")})}}
function load_quicksearch(){search_all_on_enter=true
document.querySelector("#autoComplete").addEventListener("navigate",function(event){search_all_on_enter=false});controller=new AbortController()
seenDisplayObjects={}
const autoCompleteJS=new autoComplete({data:{src:async(query)=>{try{query=document.getElementById("autoComplete").value.replace('&','~26amp')
controller.abort()
delete controller
controller=new AbortController()
let signal=controller.signal
document.getElementById('quicksearch_desktop').classList.add('placeholder-wave')
document.getElementById('autoComplete').classList.add('placeholder')
const source=await fetch('/api/quicksearch/?format=json&search='+query,{signal:signal});const data=await source.json();document.getElementById('quicksearch_desktop').classList.remove('placeholder-wave')
document.getElementById('autoComplete').classList.remove('placeholder')
seenDisplayObjects={}
return data;}catch(error){return error;}},keys:["key"],cache:false,},trigger:(query)=>{searchQuery=document.getElementById("autoComplete").value
return(searchQuery.length>-1)},query:(input)=>{return""},placeHolder:"Search by Name or ID",debounce:0,threshold:0,resultItem:{element:(item,data)=>{search_all_on_enter=true
let displayObjHeader="";if(!seenDisplayObjects[data.value.obj_display]){displayObjHeader=`<div style="display: flex; font-size: 11px; font-weight:600; color: rgba(0,0,0,.7); border-bottom: 1px solid gray; margin-left: 5px;">${data.value.obj_display}</div>`;seenDisplayObjects[data.value.obj_display]=true;let headerRow=document.createElement('div');headerRow.innerHTML=displayObjHeader;item.parentNode.insertBefore(headerRow,item);}
const markedResult=highlightMatch(data.value.display)
item.innerHTML=` 
        <a href=/${data.value.obj_type}/${data.value.key}/ style = 'color: inherit; text-decoration: inherit;'> 
          <span style="text-overflow: ellipsis; font-size: 13px;">  
            ${markedResult}
          </span>
        </a>
      `;},highlight:true,},resultsList:{maxResults:40,element:(list,data)=>{if(!data.results.length){if(document.getElementById("autoComplete").value.length>0){const message=document.createElement("div");message.setAttribute("class","no_result");message.innerHTML=`<span class="d-none d-md-inline-block"> No Results Found.  Press Enter to Search All. </span><span class="d-md-none">No Results Found.</span>`;list.appendChild(message);}}},noResults:true,},searchEngine:"strict",submit:false,events:{input:{focus(){autoCompleteJS.start();},selection(event){const feedback=event.detail;autoCompleteJS.input.blur();const selection=feedback.selection.value[feedback.selection.key];window.open("/"+feedback.selection.value.obj_type+"/"+feedback.selection.value.key,"_self");},},},});}
jQuery.fn.dataTable.Api.register('processing()',function(show){return this.iterator('table',function(ctx){ctx.oApi._fnProcessingDisplay(ctx,show);});});jQuery.fn.dataTable.Api.register('sum()',function(){return this.flatten().reduce(function(a,b){if(typeof a==='string'){a=a.replace(/[^\d.-]/g,'')*1;}
if(typeof b==='string'){b=b.replace(/[^\d.-]/g,'')*1;}
return a+b;},0);});$.fn.DataTable.ext.pager.numbers_length=5;$.fn.dataTable.ext.errMode='throw';$.extend($.fn.dataTable.defaults,{"language":{lengthMenu:'<nav>_MENU_ Shown</nav>',searchPlaceholder:"Search Keywords",search:"",processing:'<div class="spinner-border text-primary" style="width: 18px; height: 18px;" role="status"> <span class="visually-hidden">Loading</span> </div> Loading',paginate:{"next":"<i class='fa-kit fa-chevrons-right'></i>","previous":"<i class='fa-kit fa-chevrons-left'></i>"},},responsive:{details:{display:$.fn.dataTable.Responsive.display.childRowImmediate,type:'column',target:'',}},buttons:[{extend:'copyHtml5',exportOptions:{columns:[':visible']}},{extend:'csvHtml5',title:'',filename:'Data Export',exportOptions:{columns:[':visible']}},{extend:'excelHtml5',title:'',filename:'Data Export',exportOptions:{columns:[':visible']}},],searchDelay:1000,});function remove_duplicate(table){window['responsive_'+table]=false
$('#'+table).on('init.dt',function(e,datatable,columns){window['dt_'+table]=$('#'+table).DataTable()
if(!window['dt_'+table].column(1).responsiveHidden()){window['responsive_'+table]=true
if(document.getElementById(table)!==null){const elements=document.getElementById(table).getElementsByClassName('dt-hasChild');while(elements[0]){elements[0].parentNode.removeChild(elements[0]);}}}else{elems=document.getElementById(table).querySelectorAll('td.none')
for(i=0;i<elems.length;++i){elems[i].remove()}}});$('#'+table).on('responsive-resize.dt',function(e,datatable,columns){window['dt_'+table]=$('#'+table).DataTable()
if((window['dt_'+table].column(1).responsiveHidden())&&(window['responsive_'+table])){window['dt_'+table].draw()
window['responsive_'+table]=false}});}
function remove_column(json,remove_column){if(!signed_in){json['columns']=json['columns'].filter(column=>column.name!==remove_column)
json['order'][0][0]=json['order'][0][0]-1}
return json}
function export_excel(datatable_name){var table=$(datatable_name).DataTable();table.buttons('.buttons-excel').trigger();}
function export_csv(datatable_name){var table=$(datatable_name).DataTable();table.buttons('.buttons-csv').trigger();}
function copy_data(datatable_name){var table=$(datatable_name).DataTable();table.buttons('.buttons-copy').trigger();}
function redraw(table){if($.fn.DataTable.isDataTable(table)){$(table).DataTable().columns.adjust()}}
function abbr_str_number(num,symbol='$'){if(num==null){return null}
negative_flag=false
label=''
if(num<0){negative_flag=true}
num=Math.abs(num)
if(num>999999999999){divisor=1000000000000
label='T'}else if(num>999999999){divisor=1000000000
label='B'}else if(num>999999){divisor=1000000
label='M'}else if(num>999){divisor=1000
label='K'}else{divisor=1}
num=Math.round(num/divisor*10)/10
if(!negative_flag){num=symbol+num+label}else{num=symbol+'('+num+label+')'}
return num}
async function set_large_count_all(search_id,no_disable=false,signal){var endpoint=`/api/result_counter_all/?format=json&search_id=${search_id}`
const response=await fetch(endpoint,{signal:signal})
data=await response.json()
for(var i=0;i<data[0]['count'].length;i++){count=data[0]['count'][i]
target_pill_id=data[0]['table'][i]
target_pill=document.getElementById(target_pill_id)
target_pill.textContent=abbr_str_number(count,'')
if(target_pill_id=='search_transaction_pill'||target_pill_id=='search_investor_pill'||target_pill_id=='search_advisor_pill'){if(no_disable!==true){if(count>0){target_pill.classList.remove('bg-light')
target_pill.classList.add('bg-primary')
target_pill.parentElement.classList.remove('disabled')}}}else{if(count>0){target_pill.classList.remove('bg-light')
target_pill.classList.add('bg-primary')
target_pill.parentElement.classList.remove('disabled')}}}}
async function set_large_count_new(search_id,search_table,search_key,search_criteria,target_pill,min,no_disable=false,signal=null){if(search_id==null){search_id='all'}
target_pill=document.getElementById(target_pill)
var endpoint=`/api/result_counter/?format=json&search_id=${search_id}&search_table=${search_table}&search_key=${search_criteria}&search_criteria=${search_key}`
const response=await fetch(endpoint,{signal:signal})
data=await response.json()
count=data[0].count[0]
target_pill.textContent=abbr_str_number(count,'')
if(count>min){if(no_disable!==true){target_pill.classList.remove('bg-light')
target_pill.classList.add('bg-primary')
target_pill.parentElement.classList.remove('disabled')}}}
async function set_large_count(search_id,search_table,search_key,search_criteria,target_pill){if(search_id==null){search_id='undefined'}
var endpoint=`/api/result_counter/?format=json&search_id=${search_id}&search_table=${search_table}&search_key=${search_criteria}&search_criteria=${search_key}`
const response=await fetch(endpoint,)
if(response.status!=200){}
else{data=await response.json()
target_pill.textContent=abbr_str_number(data[0].count[0],'')}}
function anchor_update(anchor_id,dt){if($.fn.DataTable.isDataTable(dt)){result_count=abbr_str_number($(dt).DataTable().page.info().recordsTotal,'')}else{result_count=0}
document.getElementById(anchor_id).textContent=result_count
if(result_count!=0){document.getElementById(anchor_id).classList.remove('pe-none','link-secondary')}}
function pill_update(datatable,pill_id,override=null,search_id=null,search_table=null,search_criteria=null,search_key=null,min=0){number=$(datatable).DataTable().page.info().recordsTotal
target_pill=document.getElementById(pill_id)
if(number>min){target_pill.classList.remove('bg-light')
target_pill.classList.add('bg-primary')}
if(number>999&(search_id!=null||search_criteria!=null)){set_large_count(search_id,search_table,search_key,search_criteria,target_pill)}
if(number>999&!override){target_pill.textContent='1K+'}else{target_pill.textContent=abbr_str_number(number,'')}}
function unhide_table(datatable,nav_id,row_id,min=0){number=$(datatable).DataTable().page.info().recordsTotal
if(number>min){document.getElementById(nav_id).classList.remove('disabled')
document.getElementById(row_id).classList.remove('d-none')}else{document.getElementById(row_id).remove()}}
function divToggle(id){if(document.getElementById(id).innerHTML===' ...show all'){document.getElementById(id).innerHTML='show less'}else{document.getElementById(id).innerHTML='...show all'}
document.getElementById(id+'-full').classList.toggle('d-none')
document.getElementById(id+'-truncate').classList.toggle('d-none')}
function divToggleDt(obj){row=$(obj).closest('tr').prev()[0]._DT_RowIndex
html=$(obj).closest('tr').html()
if(html.includes('show more')){html=html.replace('full d-inline d-none','full d-inline d-block').replace('truncate d-inline d-block','truncate d-inline d-none').replace(' ...show more','show less')}else{html=html.replace('full d-inline d-block','full d-inline d-none').replace('truncate d-inline d-none','truncate d-inline d-block').replace('show less',' ...show more')}
$(datatable).DataTable().row(row).child()[0].innerHTML=html}
function divToggleModal(id){html=document.getElementById(id+'-full').innerHTML
var parser=new DOMParser();var html=parser.parseFromString(html.replace(/(?:\r\n|\r|\n)/g,'<br>'),'text/html')
document.getElementById('show_more').innerHTML=html.body.innerHTML
var myShowModal=new bootstrap.Modal(document.getElementById("showMoreModal"),{});myShowModal.show();}
function downloadUsingAnchorElementAws(url){const anchor=document.createElement("a")
anchor.href=url
document.body.appendChild(anchor)
anchor.click();document.body.removeChild(anchor)}
function downloadFile(csrf,search_table,search_params,file_type,params_manual=null,date_analysis=null,history=null){if(search_params.hasOwnProperty('id')){search_id=search_params.id}else{search_id=null}
show_toast('Export Request','<p>Export request generated.  The download will start automatically on this page when ready.  It will also be available on the <a href=/download/>Download</a> page if you navigate away.<p>')
$.post("/download_file/",{search_id:search_id,file_type:file_type,search_table:search_table,params_manual:JSON.stringify(params_manual),csrfmiddlewaretoken:csrf,date_analysis:date_analysis,history:history},function(url){if(url==='demo'){show_toast('Download Restricted','<p>Downloads are not available for trial accounts.  Please subscribe to download data.<p>')}else{downloadUsingAnchorElementAws(url)}})};function downloadDocument(resource_id,type){$.post("/download_document/",{resource_id:resource_id,type:type,csrfmiddlewaretoken:csrf,},function(url){downloadUsingAnchorElementAws(url)})};function kill_task_modal(){document.getElementById("modal_placeholder").innerHTML=''}
function task_save(csrf_token,task_key_internal){$.ajax({type:'POST',url:'/activity/save/',data:{"csrfmiddlewaretoken":csrf_token,"task_key_internal":task_key_internal,"name":document.getElementById('name').value,"description":document.getElementById('description').value,"date_due":date_due_vue.formattedDate,"meeting_with":JSON.stringify(person_task_vue.value.map(item=>item.key)),"task_owner":task_owner_vue.value&&task_owner_vue.value.id,"task_tag":JSON.stringify(task_tag_vue.value),"pursuit_key_internal":pursuit_app_vue.value&&pursuit_app_vue.value.key,"complete":document.getElementById('complete_switch').checked,"task_flag":document.getElementById('activity-task').checked,"meeting_flag":document.getElementById('activity-meeting').checked},success:function(data){let toastMessage='<p>Activity saved successfully.<p>';if(data==='alerted'){toastMessage='<p>Activity saved successfully and owner alerted via email.<p>';}
show_toast('Activity Saved',toastMessage)
kill_task_modal()
try{$('#datatable_task_search').DataTable().ajax.reload()}catch{}}})}
function delete_task(csrf_token,task_key_internal,toast_flag=false){$.ajax({type:'POST',url:'/activity/delete/'+task_key_internal,data:{"csrfmiddlewaretoken":csrf_token,},success:function(data){if(toast_flag){show_toast('Task Deleted','<p>Task deleted.<p>')
$('#datatable_task_search').DataTable().ajax.reload()}}})
kill_task_modal()}
function delete_file(csrf_token,gemini_doc_key,toast_flag=false){$.ajax({type:'POST',url:'/file_delete/'+gemini_doc_key,data:{"csrfmiddlewaretoken":csrf_token,},success:function(data){if(toast_flag){show_toast('File Deleted','<p>File deleted.<p>')
$('#datatable_file_uploads').DataTable().ajax.reload()}}})}
function contact_save(){let email=document.getElementById('contact_email').value;$.ajax({type:'POST',url:'/contact/save/',data:{"csrfmiddlewaretoken":csrf,"name":document.getElementById('contact_name').value,"title":document.getElementById('contact_title').value,"email":document.getElementById('contact_email').value,"phone":document.getElementById('contact_phone').value,"contact_type":document.getElementById('contact_type').value,"gemini_agency_key":agency_app_vue.value&&agency_app_vue.value.key,"gemini_contractor_key":prime_partner_app_vue.value&&prime_partner_app_vue.value.key,"notes":document.getElementById('contact_notes').value,},success:function(data){let toastMessage='<p>Contact saved successfully.<p>';show_toast('Contact Saved',toastMessage)
kill_contact_modal()
try{$('#datatable_contact_search').DataTable().ajax.reload()}catch{}
try{setTimeout(()=>person_task_vue.asyncFind(email),250);}catch{}}})}
function getSearchPath(){if(typeof search_params.id==='undefined'){return''}else{return'?searchID='+search_params.id}}
function watch_dt_search_buttons(){btns=document.getElementsByClassName("db-search");for(var i=0;i<btns.length;i++){btns[i].addEventListener("click",function(){search_id=nanoid()
search_json=window[this.id]
search_json.id=search_id
if(this.slot.includes('#')){table=this.slot.split('#')[0]
tab='#'+this.slot.split('#')[1]}else{table=this.slot
tab=''}
$.post("/save_search/",{search_id:search_id,search_table:table,search_json:JSON.stringify(search_json),search_saved_name:null,update_frequency:null,csrfmiddlewaretoken:csrf,}).done(function(){window.open(`/${table}/?searchID=${search_id}${tab}`,"_self")})})}}
function ExploreSub(sub_gemini_contractor_key_id,prime_gemini_contractor_key,sub_name,prime_name,type){if(type=='contract'){table='contract'
tab='#subcontract'}else{table='grant'
tab='#subgrant'}
search_json={"contractors":{"code":[{"key":sub_gemini_contractor_key_id,"display":sub_name}],"include":"Include"},"contractor_prime_sub":{"code":[{"key":prime_gemini_contractor_key,"display":prime_name}],"include":"Include"},"id":""}
search_id=nanoid()
search_json.id=search_id
$.post("/save_search/",{search_id:search_id,search_table:table,search_json:JSON.stringify(search_json),search_saved_name:null,update_frequency:null,csrfmiddlewaretoken:csrf,}).done(function(){window.open(`/${table}/?searchID=${search_id}${tab}`,"_self")})}
function PartnerFinder(partner_type){if(partner_type=='contract'){contractor_include='contracts_p'}else if(partner_type=='grant'){contractor_include='grants_p'}
search_id=nanoid()
$.post("/save_search_partner/",{search_id:search_id,search_table:table,partner_type:partner_type,key:key,csrfmiddlewaretoken:csrf,}).done(function(){window.open(`/partner-finder/?report=contractor_ranking&date_contractor=-3&contractor_include=${contractor_include}&partner_type=${partner_type}&searchID=${search_id}`,"_self")})}
function IncumbentFinder(partner_type){search_id=nanoid()
if(partner_type=='contract_incumbent'){$.post("/save_search_partner/",{search_id:search_id,search_table:table,partner_type:partner_type,key:key,csrfmiddlewaretoken:csrf,}).done(function(){window.open(`/contract/?searchID=${search_id}#contract`,"_self")})}else if(partner_type=='grant_incumbent'){$.post("/save_search_partner/",{search_id:search_id,search_table:'grant_incumbent',partner_type:partner_type,key:key,csrfmiddlewaretoken:csrf,}).done(function(){window.open(`/grant/?searchID=${search_id}#grant`,"_self")})}}
function show_chat_func(){window.__lc=window.__lc||{};window.__lc.visitor={name:user_name,email:user_email}
window.__lc.license=13815525;;(function(n,t,c){function i(n){return e._h?e._h.apply(null,n):e._q.push(n)}var e={_q:[],_h:null,_v:"2.0",on:function(){i(["on",c.call(arguments)])},once:function(){i(["once",c.call(arguments)])},off:function(){i(["off",c.call(arguments)])},get:function(){if(!e._h)throw new Error("[LiveChatWidget] You can't use getters before load.");return i(["get",c.call(arguments)])},call:function(){i(["call",c.call(arguments)])},init:function(){var n=t.createElement("script");n.async=!0,n.type="text/javascript",n.src="https://cdn.livechatinc.com/tracking.js",t.head.appendChild(n)}};!n.__lc.asyncInit&&e.init(),n.LiveChatWidget=n.LiveChatWidget||e}(window,document,[].slice))}
function toggle_chat(){show_chat=!show_chat
$.ajax({type:'POST',url:'/toggle_chat/',data:{"csrfmiddlewaretoken":csrf,"show_chat":show_chat,},})
if(show_chat){show_chat_func()
LiveChatWidget.call("maximize");document.getElementById('chat_badge_on').classList.toggle('d-none')
document.getElementById('chat_badge_off').classList.toggle('d-none')}else{LiveChatWidget.call("destroy");document.getElementById('chat_badge_on').classList.toggle('d-none')
document.getElementById('chat_badge_off').classList.toggle('d-none')}}
function toggle_sled(bool){$.ajax({type:'POST',url:`/toggle_sled/${bool}`,data:{"csrfmiddlewaretoken":csrf,}})}
if((enable_expander)&&(document.getElementById('description-fade'))){try{function wrapper(){show_all=document.getElementById('expander').classList.contains('description-expand.open')
if(show_all){if(document.getElementById('desc-wrap').offsetHeight<295){document.getElementById('description-btn').classList.add('d-none')}
else{document.getElementById('description-btn').classList.remove('d-none')}}else{var wrapHeight=$(".description-expand .desc-wrap").height();var descHeight=$(".description-expand").height()-85;if(wrapHeight<=descHeight){document.getElementById('description-fade').classList.add('d-none')
document.getElementById('description-btn').classList.add('d-none')}else{document.getElementById('description-fade').classList.remove('d-none')
document.getElementById('description-btn').classList.remove('d-none')}}}}catch{}
try{function toggle_open(){if(document.getElementById('description-btn').innerHTML=='Show Less'){document.getElementById('description-btn').innerHTML='Show More'}else{document.getElementById('description-btn').innerHTML='Show Less'}
document.getElementById('desc-wrap').classList.toggle('pb-3')
document.getElementById('description-fade').classList.toggle('d-none')
document.getElementById('expander').classList.toggle('description-expand')
document.getElementById('expander').classList.toggle('description-expand.open')}}catch{}
wrapper()
window.onresize=wrapper}
function soft_paywall_modal(){var myModal=new bootstrap.Modal(document.getElementById('staticBackdrop'),{})
myModal.show()}
function no_premium_access_modal(){var myModal=new bootstrap.Modal(document.getElementById('staticBackdrop'),{})
myModal.show()}
function createLinkEmail(){window.location.href=`mailto:?subject=${display} | HigherGov&body=${window.location.href}`;}
function createLinkEmailSearch(){window.location.href=`mailto:?subject=${document.title}&body=${window.location.href}`;}
function copyLinkClipboard(){navigator.clipboard.writeText(window.location.href)
show_toast('Copied to Clipboard','<p>URL Copied to Clipboard<p>')}
function createTweet(){page_title=encodeURIComponent(document.title)
window.open(`https://twitter.com/intent/tweet?url=${window.location.href}&text=${page_title}`,'_blank');}
function createLinkedIn(){page_title=encodeURIComponent(document.title)
window.open(`https://www.linkedin.com/shareArticle?mini=true&url=${window.location.href}&title=${page_title}`,'_blank');}
function submit_question(){const message=$("#emailMessage").val();$.post("/submit-question",{table:table,key:key,message:message,csrfmiddlewaretoken:csrf,}).done(function(data){if(data==="Success"){show_toast("Question Request Received",`<p>We will anonymously submit your questions in the next 8 hours and provide any responses to you via email.<p>`);$("#emailMessage").val("");}});}
let chatId
function submit_question_ai(button){document.getElementById('AiMessage').style.height='1.5em';let spinnerTimeout1,spinnerTimeout2;function startSpinnerStatus(){const container=document.getElementById('spinnerContainer');const spinnerStatus=document.getElementById('spinnerStatus');container.classList.remove('d-none');spinnerStatus.textContent="Identifying documents...";spinnerTimeout1=setTimeout(()=>{spinnerStatus.textContent="Analyzing documents...";},2500);spinnerTimeout2=setTimeout(()=>{spinnerStatus.textContent="Preparing response...";},3500);}
function stopSpinnerStatus(){const container=document.getElementById('spinnerContainer');document.getElementById('spinnerStatus').textContent="";container.classList.add('d-none');clearTimeout(spinnerTimeout1);clearTimeout(spinnerTimeout2);}
try{document.getElementById('suggestions').classList.add('d-none');document.getElementById('linked_profile').classList.add('d-none');}catch{}
button.disabled=true;const userInput=document.getElementById('AiMessage');const userMessage=userInput.value;userInput.value='';userInput.disabled=true;const chatBox=document.querySelector('.chat-box');const newUserMessage=document.createElement('div');newUserMessage.classList.add('chat-message','user');newUserMessage.innerHTML=`<p class="message">${userMessage}</p>`;chatBox.appendChild(newUserMessage);chatBox.scrollTop=chatBox.scrollHeight;if(!chatId){chatId=nanoid();}
const spinner=document.getElementById('loadingSpinner');chatBox.appendChild(document.getElementById('spinnerContainer'));startSpinnerStatus();chatBox.scrollTop=chatBox.scrollHeight+10;$.post("/submit-question-ai",{table:table,key:key,message:userMessage,chatId:chatId,csrfmiddlewaretoken:csrf,}).done(function(data){console.log('Received data:',data);if(data&&data.text){const formattedContent=data.text.content.replace(/\n/g,'<br>');const newBotMessage=document.createElement('div');newBotMessage.classList.add('chat-message','bot');newBotMessage.innerHTML=`<p class="message">${formattedContent}</p>`;chatBox.appendChild(newBotMessage);chatBox.scrollTop=chatBox.scrollHeight+10;copy_watch()}
userInput.disabled=false;button.disabled=false;stopSpinnerStatus();document.getElementById('resetai').disabled=false;document.getElementById('AiMessage').focus();}).fail(function(error){userInput.disabled=false;button.disabled=false;stopSpinnerStatus();document.getElementById('AiMessage').focus();const newBotMessage=document.createElement('div');newBotMessage.classList.add('chat-message','bot');newBotMessage.innerHTML=`<p class="message">I'm sorry, unfortunately we're having difficulty processing this question right now.  </p>`;chatBox.appendChild(newBotMessage);chatBox.scrollTop=chatBox.scrollHeight+10;console.error('Error submitting the question:',error);button.disabled=false;userInput.disabled=false;document.getElementById('resetai').disabled=false;});}
function handleSuggestionClick(suggestion){const userInput=document.getElementById('AiMessage');userInput.value=suggestion;document.getElementById('submitAiMessage').disabled=false
document.getElementById('submitAiMessage').click();}
function handleButtonClick(button,question){button.classList.add('d-none');var textarea=document.getElementById('emailMessage');textarea.value+=(textarea.value.length===0?'':'\n')+question;document.getElementById('submitEmailButton').disabled=false}
function copy_watch(){const tooltips=[];document.querySelectorAll('.chat-message .message').forEach(message=>{const tooltip=new bootstrap.Tooltip(message);tooltips.push(tooltip);message.addEventListener('click',(event)=>{const htmlContent=event.target.innerHTML;copyToClipboard(htmlContent);message.setAttribute('data-bs-original-title','Copied to Clipboard');tooltip.show();setTimeout(()=>{message.setAttribute('data-bs-original-title','Click to Copy');tooltip.hide();},2000);});});}
function ResetAiChat(){chatId=nanoid();document.querySelectorAll('.chat-message:not(.original-message)').forEach(el=>el.remove());if(table!='sl_contract_opportunity'){document.getElementById('suggestions')?.classList.remove('d-none');}}
function copyToClipboard(html){const blob=new Blob([html],{type:'text/html'});const item=new ClipboardItem({'text/html':blob});navigator.clipboard.write([item]).then(function(){console.log('Copied to clipboard');}).catch(function(err){console.error('Could not copy text: ',err);});}
function createZip(){const data={csrfmiddlewaretoken:csrf,zip_file_name:display+'.zip',search_params:JSON.stringify(datatable_document_search_params),table:table};show_toast('ZIP File In Process',`<p>We're creating a .zip file for you. The download will start automatically, please do not leave this page.<p>`)
$.ajax({type:'POST',url:'/create_zip_file/',data:data,success:function(response){if(response.success){window.location.href=response.signed_url;show_toast('ZIP File Create',`<p>Zip file created, downloading now.<p>`)}else{show_toast('Failed to Create ZIP',`<p>Unfortunately we're unable to create a ZIP for this opportunity.<p>`)
console.error('Error creating zip file:',response.error);}},error:function(xhr,status,error){console.error('Ajax error:',error);}});}
function printActiveChart(...tabChartPairs){for(let i=0;i<tabChartPairs.length;i+=2){const tabId=tabChartPairs[i];const chart=tabChartPairs[i+1];const tab=document.getElementById(tabId);console.log(tab.classList)
if(tab.classList.contains('active')){const link=document.createElement('a');link.href=chart.toBase64Image();link.download='chart.png';link.click();show_toast("Exporting",`<p>Chart export started.<p>`);return;}}
show_toast("No Chart Visible",`<p>No chart currently visible.  Please select a chart to export.<p>`);}
let opportunityKey
let docDropzoneObj=null;let currentTab="capability";let dropzoneScriptLoaded=false
function prepareDocDropzone(startTab='capability'){function activateTab(tab){document.getElementById('capability-tab').classList.toggle('active',tab==='capability');document.getElementById('opportunity-tab').classList.toggle('active',tab==='opportunity');setTab(tab);}
if(!dropzoneScriptLoaded){let css=document.createElement('link');css.rel="stylesheet";css.href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/basic.min.css";document.head.appendChild(css);let script=document.createElement('script');script.src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/min/dropzone.min.js";script.onload=function(){setupDocDropzone();activateTab(startTab);var modal=new bootstrap.Modal(document.getElementById('docLibraryModal'));modal.show();};document.body.appendChild(script);dropzoneScriptLoaded=true;}else if(!docDropzoneObj){setupDocDropzone();activateTab(startTab);var modal=new bootstrap.Modal(document.getElementById('docLibraryModal'));modal.show();}else{activateTab(startTab);var modal=new bootstrap.Modal(document.getElementById('docLibraryModal'));modal.show();}}
function getFileIcon(fileType){fileType=(fileType||'').toLowerCase();if(fileType==='pdf'){return'<i class="fa-kit fa-file-pdf text-danger" style="font-size: 16px;"></i> ';}else if(fileType==='docx'||fileType==='doc'){return'<i class="fa-kit fa-file-word text-primary" style="font-size: 16px;"></i> ';}else if(fileType==='xlsx'||fileType==='xls'){return'<i class="fa-kit fa-file-excel" style="color:green; font-size:16px;"></i> ';}else{return'<i class="fa-kit fa-file text-secondary" style="font-size:16px;"></i> ';}}
function loadDocCards(tabType){opportunityKey=key||"";let url=tabType==='capability'?'/stored-docs-capability/':`/stored-docs-opportunity/?opportunity_key=${encodeURIComponent(opportunityKey)}`;fetch(url,{credentials:'include'}).then(r=>r.json()).then(data=>{let docs=data.docs||[];docs.sort((a,b)=>new Date(b.upload_timestamp)-new Date(a.upload_timestamp));let box=document.getElementById('doc-library-cards');box.innerHTML="";if(!docs.length){box.innerHTML='<div class="text-center text-secondary py-4"><em>No documents uploaded yet.</em></div>';return;}
docs.forEach(doc=>{let card=document.createElement('div');card.className="card mb-2";card.innerHTML=`
          <div class="card-body d-flex justify-content-between align-items-center">
            <span>
                ${getFileIcon(doc.file_type)}
                ${doc.file_name}
            </span>
              <button class="btn btn-sm btn-danger" onclick="deleteDoc('${doc.gemini_doc_key}', '${tabType}')">Delete</button>
            </div>
          `;box.appendChild(card);});});}
function deleteDoc(docKey,tabType){fetch('/delete-doc/',{method:'POST',headers:{'Content-Type':'application/json',},body:JSON.stringify({doc_key:docKey})}).then(r=>r.json()).then(data=>{if(data.success){setTab(tabType);}else{}});}
function setTab(tabType){currentTab=tabType;if(tabType==="capability"){document.getElementById("dropzone-header-text").innerText="Drop or click to upload a Capability Statement (.pdf, .docx, or .xlsx)";docDropzoneObj.options.headers['source']="capability_statement";docDropzoneObj.options.headers['opportunity_key']="";}else{document.getElementById("dropzone-header-text").innerText="Drop or click to upload an Opportunity Document (.pdf or .docx, or .xlsx)";docDropzoneObj.options.headers['source']="opportunity_document";docDropzoneObj.options.headers['opportunity_key']=opportunityKey;}
loadDocCards(tabType);}
function setupDocDropzone(){Dropzone.autoDiscover=false;docDropzoneObj=new Dropzone('#docLibraryDropzone',{paramName:"file",maxFilesize:100,parallelUploads:10,acceptedFiles:".pdf,.docx,.xlsx",addRemoveLinks:false,headers:{'X-CSRFToken':csrf,'source':'capability_statement','opportunity_key':'',},init:function(){this.on("sending",function(file,xhr,formData){formData.append("source",currentTab==="capability"?"capability_statement":"opportunity_document");if(currentTab==="opportunity"){formData.append("opportunity_key",opportunityKey);}});this.on("queuecomplete",function(){});this.on("success",function(file,response){if(response.success){setTimeout(()=>{this.removeFile(file);},100);setTab(currentTab);}else{show_toast('Upload Failed',"File failed to upload")}});this.on("error",function(file,error){show_toast('Upload Failed',"File failed to upload")});}});}
function enableClickOutsideToCloseForOffcanvas(offcanvasId){var offcanvas=document.getElementById(offcanvasId);if(!offcanvas)return;function closeOnClickOutside(event){if(offcanvas.classList.contains('show')&&!offcanvas.contains(event.target)){var instance=bootstrap.Offcanvas.getOrCreateInstance(offcanvas);instance.hide();}}
function removeListeners(){document.removeEventListener('mousedown',closeOnClickOutside);document.removeEventListener('touchstart',closeOnClickOutside);offcanvas.removeEventListener('hidden.bs.offcanvas',removeListeners);}
document.addEventListener('mousedown',closeOnClickOutside);document.addEventListener('touchstart',closeOnClickOutside);offcanvas.addEventListener('hidden.bs.offcanvas',removeListeners);}
function assistantLabelSwap(type){let word=document.getElementById('assistant-label-word');let label2=document.getElementById('assistant-label2');let defaultWord=document.getElementById('assistant-label-text').getAttribute('data-defaultword')||'Opportunity';if(!word||!label2)return;if(type==='disable'){word.textContent='Disable';label2.textContent='Assistant';}else if(type==='open'){word.textContent='Open';label2.textContent='Assistant';}else{word.textContent=defaultWord;label2.textContent='Assistant';}}
window.deleteDoc=deleteDoc;function toggle_show_ai_assistant(){$.post('/toggle_show_ai_assistant/',{show_ai_assistant:document.getElementById('show_ai_assistant').checked,csrfmiddlewaretoken:csrf});}
function disable_ai_assistant(){$.post('/disable_ai_assistant/',{show_ai_assistant:false,csrfmiddlewaretoken:csrf});}
if(no_auth){window.onload=soft_paywall_modal()}
if(no_premium_access){window.onload=no_premium_access_modal()}
window.onload=highlight_sidebar()
window.onload=enable_side_bar()
window.onload=load_toast()
window.onload=load_tooltips()
window.onload=load_search_modals()
window.onload=load_quicksearch()
window.onload=load_popovers()
if(show_chat){window.onload=show_chat_func()}
try{if(store_recent_flag==true&&signed_in){window.onload=setTimeout(store_recent,2000)}}catch{};window.AjaxDatatableViewUtils=(function(){var _options={};function init(options){_options=options;if(!('language'in _options)){_options.language={};}}
function getCookie(name){var cookieValue=null;var value='; '+document.cookie,parts=value.split('; '+name+'=');if(parts.length==2)cookieValue=parts.pop().split(';').shift();return cookieValue;}
function getCSRFToken(){var csrftoken=getCookie('csrftoken');if(csrftoken==null){csrftoken=$('input[name=csrfmiddlewaretoken]').val();}
return csrftoken;}
function adjust_table_columns(){$.fn.dataTable.tables({visible:true,api:true}).columns.adjust();};function initialize_table(element,url,extra_options={},extra_data={},placeholder={}){var data={action:'initialize'};if(extra_data){Object.assign(data,extra_data);}
$.ajax({type:'POST',url:url,data:data,dataType:'json',headers:{'X-CSRFToken':getCSRFToken()}}).done(function(data,textStatus,jqXHR){var options={processing:true,serverSide:true,scrollX:true,autoWidth:true,dom:'<"toolbar">lrftip',language:_options.language,full_row_select:false,ajax:function(data,callback,settings){var table=$(this);data.date_from=table.data('date_from');data.date_to=table.data('date_to');if(extra_data){Object.assign(data,extra_data);}
$.ajax({type:'POST',url:url,data:data,dataType:'json',cache:false,crossDomain:false,headers:{'X-CSRFToken':getCSRFToken()}}).done(function(data,textStatus,jqXHR){callback(data);}).fail(function(jqXHR,textStatus,errorThrown){});},columns:data.columns,searchCols:data.searchCols,lengthMenu:data.length_menu,order:data.order,initComplete:function(){setTimeout(function(){table.DataTable().columns.adjust()},50);table.trigger('initComplete',[table]);},drawCallback:function(settings){table.trigger('drawCallback',[table,settings]);},rowCallback:function(row,data){table.trigger('rowCallback',[table,row,data]);},footerCallback:function(row,data,start,end,display){table.trigger('footerCallback',[table,row,data,start,end,display]);}}
if(extra_options){Object.assign(options,extra_options);}
var table=element.dataTable(options);})}
function initialize_table_simple(element,url,extra_options={},extra_data={},data={}){if(extra_data){Object.assign(data,extra_data);}
var options={processing:true,serverSide:true,scrollX:true,autoWidth:true,ajax:function(data,callback,settings){var table=$(this);data.date_from=table.data('date_from');data.date_to=table.data('date_to');if(extra_data){Object.assign(data,extra_data);}
$.ajax({type:'POST',url:url,data:data,dataType:'json',cache:false,crossDomain:false,headers:{'X-CSRFToken':getCSRFToken()}}).done(function(data,textStatus,jqXHR){callback(data);}).fail(function(jqXHR,textStatus,errorThrown){});},columns:data.columns,searchCols:data.searchCols,lengthMenu:data.length_menu,order:data.order,initComplete:function(){setTimeout(function(){table.DataTable().columns.adjust()},50);table.trigger('initComplete',[table]);},drawCallback:function(settings){table.trigger('drawCallback',[table,settings]);load_tooltips()},rowCallback:function(row,data){table.trigger('rowCallback',[table,row,data]);},}
if(extra_options){Object.assign(options,extra_options);}
var table=element.dataTable(options);}
function redraw_table(element){var table=$(element).closest('table.dataTable');table.DataTable().ajax.reload(null,false);}
return{init:init,initialize_table:initialize_table,initialize_table_simple:initialize_table_simple,adjust_table_columns:adjust_table_columns,redraw_table:redraw_table};})();;